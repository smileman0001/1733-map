function zero_first_format(t) { return t < 10 && (t = "0" + t), t } let count = 700, len = track.getTotalLength(), seg = len / (count + 1), pos = seg - 1, target = seg, numb = 0, city_id = 0, numeric = 0, numeric2 = 0, id = 0, prev_id = 0, days = 0, tt = 0, pipka_x_pos = 0, text_x_pos = 0, text_y_pos = 0, with_the_flow = !0, stands_still = !0, relax = !1, modal = new bootstrap.Modal(document.querySelector("#modal")); var current_datetime = new Date(1731, 3, 15); function date_time() { var t = current_datetime, e = zero_first_format(t.getDate()), i = zero_first_format(t.getMonth() + 1), r = t.getFullYear(); document.getElementById("time").innerHTML = e + "." + i + "." + r } var cities_info = "1, Екатеринбург, 15!5, История про Екатеринбург|5, Горохово плотбище, -121!10, История про Горохово плотбище|10, Макаровская пристань, -150!5, История про Макаровская пристань|20, Уткинская пристань, 10!3, История про Уткинская пристань|25, Каменская пильная мельница, 10!2, История про Каменская пильная мельница|30, Курьинская пристань, 10!0, История про Курьинская пристань|35, Илимская пристань, -123!10, История про Илимская пристань|40, Сулемская пристань, 10!0, История про Сулемская пристань|50, Ослянская пристань, 10!0, История про Ослянская пристань|60, Камасино, 0!-10, История про Камасино|70, Чусовские городки, -55!-40, История про Чусовские городки|81, Васильев луг, -80!-20, История про Васильев луг|88, Ерошиха, -60!-10, История про Ерошиха|121, Оса, -30!-3, История про Оса|158, Сарапул, 10!0, История про Сарапул|175, Елабуга, 10!9, История про Елабуга|205, Свиные горы, -33!-22, История про Свиные горы|230, Рыбная слобода, 0!18, История про Рыбная слобода|240, Лаишево, -30!20, История про Лаишево|257, Казань, 10!3, История про Казань|260, Верхний Услон, -18!-10, История про Верхний Услон|290, Чебоксары, 10!-3, История про Чебоксары|298, Козьмодемьянск, -50!-10, История про Козьмодемьянск|320, Макарьевская ярмарка, -58!18, История про Макарьевская ярмарка|335, Нижний Новгород, -120!4, История про Нижний Новгород|340, Балахна, -5!-10, История про Балахна|400, Кострома, 5!-5, История про Кострома|415, Ярославль, -10!20, История про Ярославль|430, Рыбная Слобода, 0!-10, История про Рыбная Слобода|440, Молога, -25!-10, История про Молога|450, Мышкино, -70!3, История про Мышкино|460, Углич, 12!0, История про Углич|470, Калязин, 5!15, История про Калязин|510, Тверь, 0!-10, История про Тверь|518, Торжок, -35!16, История про Торжок|540, Вышний Волочёк, 8!0, История про Вышний Волочёк|580, Опеченская пристань, 10!0, История про Опеченская пристань|585, Боровичи, -15!-15, История про Боровичи|595, Потерпельская пристань, -150!-10, История про Потерпельская пристань|610, Великий Новгород, -50!20, История про Великий Новгород|665, Новая Лагода, 15!0, История про Новая Лагода|680, Шлиссельбург, -50!-14, История про Шлиссельбург|699, Санкт-Петербург, -40!25, История про Санкт-Петербург"; function map_cities(t, e, r) { if (1 == r) for (i = 0; i < e.length; i++)t.set(i, e[i]); else for (i = 0; i < e.length; i++)t.set(e[i].position, e[i]); return t } let temporary = document.getElementById("temporary"); all_cities = JSON.parse(temporary.text), temporary.remove(), cities_by_number = new Map, cities_by_number = map_cities(cities_by_number, all_cities, 1), console.log(cities_by_number), cities_by_pos = new Map, cities_by_pos = map_cities(cities_by_pos, all_cities, 2), console.log(cities_by_pos), svg.innerHTML += Array(count).fill(0).map((t, e) => { let i = seg * e, r = track.getPointAtLength(i); if (cities_by_pos.has(e)) { 1 != e && 10 != e && 5 != e && (pipka_x_pos = 1474 - 2.181 * e), numb += 1; let t = r.x, n = r.y; return 1 == e && (t = 1350, n = 280), "<g transform=translate(" + [t, n] + ') class="map-area" data-postid="' + cities_by_pos.get(e).postid + '">  <circle data-len=' + i.toFixed(1) + " r=4 id=" + e + "></circle>  <text id=" + e + " fill=#2D2E2C class=cities x=" + cities_by_pos.get(e).text_position[0] + " y=" + cities_by_pos.get(e).text_position[1] + ">" + cities_by_pos.get(e).name + "</text>  <ellipse id=" + e + " cx=0 cy=-10 rx=0 ry=5 stroke=none/> </g><g transform=translate(" + pipka_x_pos + ",705)>  <rect class=pipka id=" + e + " width=3 height=10 /></g>" } return "<g></g>" }).join(""), target = +document.querySelector('circle[id="20"]').getAttribute("data-len"); let circles = document.querySelectorAll("circle"), a = document.querySelectorAll("ellipse"); function render() { let t = target - pos, e = "", i = 0, r = document.querySelector('circle[id="88"]'), n = document.querySelector('circle[id="121"]'); null != r && null != n && (!0 === (with_the_flow = !(pos > +r.getAttribute("data-len") && pos < +n.getAttribute("data-len"))) ? (e = "Плывет по течению", i = 2) : (e = "Плывет против течения", i = 1)), t > 1 || t < -1 ? (id > 0 && (target < pos ? tt -= i : tt += i), stands_still = !1, prev_id = id, change_ellipse_radius(id, 0)) : (e = "Стоит на месте", document.getElementById("hint").innerHTML = e, !1 === stands_still ? (0 == id && (id = 4), .1 == id && (id = 0), 4 == id && (current_datetime = new Date(1731, 3, 15), print_hint(days, e), tt = 0), stands_still = !0, change_ellipse_radius(id, 10)) : (4 == id && (current_datetime = new Date(1731, 3, 15), print_hint(days, e), tt = 0), change_ellipse_radius(id, 10))), tt % 2 != 1 && tt % 2 != -1 || !0 !== with_the_flow || (tt = 0), 10 == tt && (current_datetime.setDate(current_datetime.getDate() + 1), print_hint(days, e), tt = 0), -10 == tt && (current_datetime.setDate(current_datetime.getDate() - 1), print_hint(days, e), tt = 0), pos += Math.abs(t) < 1 ? 0 : Math.sign(t); let o = track.getPointAtLength(pos - 10), s = track.getPointAtLength(pos + 5), l = 180 * Math.atan2(s.y - o.y, s.x - o.x) / Math.PI; ship.setAttribute("transform", "translate(" + o.x + "," + o.y + ")rotate(" + l + ")"), date_time(), requestAnimationFrame(render) } setTimeout(render, 0); let value = $(".scroll").prev().attr("value"); function animate(t) { t.style.fill = "#2D2E2C", target = +t.dataset.len, cities_by_number.has(id) && (document.querySelector('ellipse[id="' + cities_by_number.get(id).position + '"]').setAttribute("rx", 0), document.querySelector('rect[id="' + cities_by_number.get(id).position + '"]').setAttribute("y", 0), document.querySelector('circle[id="' + cities_by_number.get(id).position + '"]').style.fill = "#E8E1C1", document.querySelector('text[id="' + cities_by_number.get(id).position + '"]').style.fontWeight = "normal"), id = getKey(t.getAttribute("id")), document.querySelector('rect[id="' + cities_by_number.get(id).position + '"]').setAttribute("y", -5), document.querySelector('text[id="' + cities_by_number.get(id).position + '"]').style.fontWeight = "bold", document.getElementById("scroll").value = Number(t.getAttribute("id")) + 1, 0 == id && (id = .1) } var timeout; function print_hint(t, e) { word_day = t % 10 == 1 && t % 100 != 11 ? " день" : t % 10 == 2 && t % 100 != 12 ? " дня" : t % 10 == 3 && t % 100 != 13 ? " дня" : t % 10 == 4 && t % 100 != 14 ? " дня" : " дней", document.getElementById("hint").innerHTML = e } function change_ellipse_radius(t, e) { cities_by_number.has(t) && document.querySelector('ellipse[id="' + cities_by_number.get(t).position + '"]').setAttribute("rx", e) } function getKey(t) { return cities_by_pos.get(Number(t)).id } $(".scroll").html(value), $(".scroll").on("input", function () { let t = $(".scroll").val() - 1; if (1 != t && 10 != t && 5 != t) { let t = document.querySelector('circle[id="' + ($(".scroll").val() - 1) + '"]'); null != t && animate(t) } }), a.forEach(t => t.onclick = (t => { modal.toggle() })), document.getElementById("side_river_wrapper").onclick = (t => { showAlert("Путь до Москвы", "<p>Содержимое окна...</p>") }), $(".side_river_wrapper").hover(function () { $(".side_river").animate({ strokeWidth: 6 }, 150) }, function () { $(".side_river").animate({ strokeWidth: 3 }, 150) }), circles.forEach(t => t.onclick = (e => { let i = t.getAttribute("id"); 1 != i && 10 != i && 5 != i ? (e.preventDefault(), animate(t)) : modal.toggle() })), circles.forEach(t => { let e = t.getAttribute("id"); 5 != e && 10 != e && 1 != e ? (t.onmouseover = function (e) { timeout = setTimeout(function () { t.setAttribute("r", 6) }, 10) }, t.onmouseout = function (e) { timeout = setTimeout(function () { t.setAttribute("r", 4) }, 10) }) : (t.style.fill = "#2D2E2C", t.setAttribute("r", 3)) });